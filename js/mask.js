!function(){"use strict";angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},clearOnBlur:!0,clearOnBlurPlaceholder:!1,escChar:"\\",eventsToHandle:["input","keyup","click","focus"],addDefaultPlaceholder:!0,allowInvalidValue:!1}).provider("uiMask.Config",function(){var a={};this.maskDefinitions=function(b){return a.maskDefinitions=b},this.clearOnBlur=function(b){return a.clearOnBlur=b},this.clearOnBlurPlaceholder=function(b){return a.clearOnBlurPlaceholder=b},this.eventsToHandle=function(b){return a.eventsToHandle=b},this.addDefaultPlaceholder=function(b){return a.addDefaultPlaceholder=b},this.allowInvalidValue=function(b){return a.allowInvalidValue=b},this.$get=["uiMaskConfig",function(b){var c=b;for(var d in a)angular.isObject(a[d])&&!angular.isArray(a[d])?angular.extend(c[d],a[d]):c[d]=a[d];return c}]}).directive("uiMask",["uiMask.Config",function(a){function b(a){return a===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(a.type||a.href||~a.tabIndex)}return{priority:100,require:"ngModel",restrict:"A",compile:function(){var c=angular.copy(a);return function(a,d,e,f){function y(a){return angular.isDefined(a)?(O(a),g?(G(),H(),!0):F()):F()}function z(a){a&&(k=a,!g||0===d.val().length&&angular.isDefined(e.placeholder)||d.val(L(K(d.val()))))}function A(){return y(e.uiMask)}function C(a){return g?(n=K(a||""),p=J(n),f.$setValidity("mask",p),n.length&&(p||E.allowInvalidValue)?L(n):void 0):a}function D(a){return g?(n=K(a||""),p=J(n),f.$viewValue=n.length?L(n):"",f.$setValidity("mask",p),p||E.allowInvalidValue?B?f.$viewValue:n:void 0):a}function F(){return g=!1,I(),angular.isDefined(q)?d.attr("placeholder",q):d.removeAttr("placeholder"),angular.isDefined(r)?d.attr("maxlength",r):d.removeAttr("maxlength"),d.val(f.$modelValue),f.$viewValue=f.$modelValue,!1}function G(){n=t=K(f.$modelValue||""),o=s=L(n),p=J(n),e.maxlength&&d.attr("maxlength",2*i[i.length-1]),!q&&E.addDefaultPlaceholder&&d.attr("placeholder",k);for(var a=f.$modelValue,b=f.$formatters.length;b--;)a=f.$formatters[b](a);f.$viewValue=a||"",f.$render()}function H(){h||(d.bind("blur",Q),d.bind("mousedown mouseup",S),d.bind("keydown",U),d.bind(E.eventsToHandle.join(" "),V),h=!0)}function I(){h&&(d.unbind("blur",Q),d.unbind("mousedown",S),d.unbind("mouseup",S),d.unbind("keydown",U),d.unbind("input",V),d.unbind("keyup",V),d.unbind("click",V),d.unbind("focus",V),h=!1)}function J(a){return a.length?a.length>=m:!0}function K(a){var h,i,b="",c=d[0],e=j.slice(),f=u,g=f+Z(c),m="";return a=a.toString(),h=0,i=a.length-k.length,angular.forEach(l,function(b){var c=b.position;c>=f&&g>c||(c>=f&&(c+=i),a.substring(c,c+b.value.length)===b.value&&(m+=a.slice(h,c),h=c+b.value.length))}),a=m+a.slice(h),angular.forEach(a.split(""),function(a){e.length&&e[0].test(a)&&(b+=a,e.shift())}),b}function L(a){var b="",c=i.slice();return angular.forEach(k.split(""),function(d,e){a.length&&e===c[0]?(b+=a.charAt(0)||"_",a=a.substr(1),c.shift()):b+=d}),b}function M(a){var c,b=angular.isDefined(e.uiMaskPlaceholder)?e.uiMaskPlaceholder:e.placeholder;return angular.isDefined(b)&&b[a]?b[a]:(c=angular.isDefined(e.uiMaskPlaceholderChar)&&e.uiMaskPlaceholderChar?e.uiMaskPlaceholderChar:"_","space"===c.toLowerCase()?" ":c[0])}function N(){var b,c,a=k.split("");i&&!isNaN(i[0])&&angular.forEach(i,function(b){a[b]="_"}),b=a.join(""),c=b.replace(/[_]+/g,"_").split("_"),c=c.filter(function(a){return""!==a});var d=0;return c.map(function(a){var c=b.indexOf(a,d);return d=c+1,{value:a,position:c}})}function O(a){var b=0;if(i=[],j=[],k="",angular.isString(a)){m=0;var c=!1,d=0,e=a.split(""),f=!1;angular.forEach(e,function(a,e){f?(f=!1,k+=a,b++):E.escChar===a?f=!0:E.maskDefinitions[a]?(i.push(b),k+=M(e-d),j.push(E.maskDefinitions[a]),b++,c||m++,c=!1):"?"===a?(c=!0,d++):(k+=a,b++)})}i.push(i.slice().pop()+1),l=N(),g=i.length>1?!0:!1}function Q(){if((E.clearOnBlur||E.clearOnBlurPlaceholder&&0===n.length&&e.placeholder)&&(u=0,v=0,p&&0!==n.length||(o="",d.val(""),a.$apply(function(){f.$pristine||f.$setViewValue("")}))),n!==P){var b=d.val(),c=""===n&&b&&angular.isDefined(e.uiMaskPlaceholderChar)&&"space"===e.uiMaskPlaceholderChar;c&&d.val(""),R(d[0]),c&&d.val(b)}P=n}function R(a){var b;angular.isFunction(window.Event)&&!a.fireEvent?(b=new Event("change",{view:window,bubbles:!0,cancelable:!1}),a.dispatchEvent(b)):"createEvent"in document?(b=document.createEvent("HTMLEvents"),b.initEvent("change",!1,!0),a.dispatchEvent(b)):a.fireEvent&&a.fireEvent("onchange")}function S(a){"mousedown"===a.type?d.bind("mouseout",T):d.unbind("mouseout",T)}function T(){v=Z(this),d.unbind("mouseout",T)}function U(a){var b=8===a.which,c=X(this)-1||0;if(b){for(;c>=0;){if(W(c)){Y(this,c+1);break}c--}w=-1===c}}function V(b){b=b||{};var c=b.which,e=b.type;if(16!==c&&91!==c){var j,g=d.val(),h=s,l=!1,m=K(g),n=t,o=X(this)||0,p=u||0,q=o-p,r=i[0],x=i[m.length]||i.slice().shift(),y=v||0,z=Z(this)>0,A=y>0,B=g.length>h.length||y&&g.length>h.length-y,C=g.length<h.length||y&&g.length===h.length-y,D=c>=37&&40>=c&&b.shiftKey,E=37===c,F=8===c||"keyup"!==e&&C&&-1===q,G=46===c||"keyup"!==e&&C&&0===q&&!A,H=(E||F||"click"===e)&&o>r;if(v=Z(this),!D&&(!z||"click"!==e&&"keyup"!==e&&"focus"!==e)){if(F&&w)return d.val(k),a.$apply(function(){f.$setViewValue("")}),void Y(this,p);if("input"===e&&C&&!A&&m===n){for(;F&&o>r&&!W(o);)o--;for(;G&&x>o&&-1===i.indexOf(o);)o++;var I=i.indexOf(o);m=m.substring(0,I)+m.substring(I+1),m!==n&&(l=!0)}for(j=L(m),s=j,t=m,!l&&g.length>j.length&&(l=!0),d.val(j),l&&a.$apply(function(){f.$setViewValue(j)}),B&&r>=o&&(o=r+1),H&&o--,o=o>x?x:r>o?r:o;!W(o)&&o>r&&x>o;)o+=H?-1:1;(H&&x>o||B&&!W(p))&&o++,u=o,Y(this,o)}}}function W(a){return i.indexOf(a)>-1}function X(a){if(!a)return 0;if(void 0!==a.selectionStart)return a.selectionStart;if(document.selection&&b(d[0])){a.focus();var c=document.selection.createRange();return c.moveStart("character",a.value?-a.value.length:0),c.text.length}return 0}function Y(a,c){if(!a)return 0;if(0!==a.offsetWidth&&0!==a.offsetHeight)if(a.setSelectionRange)b(d[0])&&(a.focus(),a.setSelectionRange(c,c));else if(a.createTextRange){var e=a.createTextRange();e.collapse(!0),e.moveEnd("character",c),e.moveStart("character",c),e.select()}}function Z(a){return a?void 0!==a.selectionStart?a.selectionEnd-a.selectionStart:window.getSelection?window.getSelection().toString().length:document.selection?document.selection.createRange().text.length:0:0}var i,j,k,l,m,n,o,p,s,t,u,v,w,g=!1,h=!1,q=e.placeholder,r=e.maxlength,x=f.$isEmpty;f.$isEmpty=function(a){return x(g?K(a||""):a)};var B=!1;e.$observe("modelViewValue",function(a){"true"===a&&(B=!0)}),e.$observe("allowInvalidValue",function(a){E.allowInvalidValue=""===a?!0:!!a,C(f.$modelValue)});var E={};e.uiOptions?(E=a.$eval("["+e.uiOptions+"]"),E=angular.isObject(E[0])?function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(void 0===b[c]?b[c]=angular.copy(a[c]):angular.isObject(b[c])&&!angular.isArray(b[c])&&(b[c]=angular.extend({},a[c],b[c])));return b}(c,E[0]):c):E=c,e.$observe("uiMask",y),angular.isDefined(e.uiMaskPlaceholder)?e.$observe("uiMaskPlaceholder",z):e.$observe("placeholder",z),angular.isDefined(e.uiMaskPlaceholderChar)&&e.$observe("uiMaskPlaceholderChar",A),f.$formatters.unshift(C),f.$parsers.unshift(D);var P=d.val();d.bind("mousedown mouseup",S),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1})}}}}])}();
